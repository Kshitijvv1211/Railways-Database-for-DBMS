-- INSERT INTO Train_fare (Train_code, Class_id, From_Km, To_Km, From_date, To_date, Fare) VALUES
-- ('12301', 'C001', 0, 1447, '2025-01-01', '2025-12-31', 4655.00),
-- ('12301', 'C002', 0, 1447, '2025-01-01', '2025-12-31', 2750.00),
-- ('12301', 'C003', 0, 1447, '2025-01-01', '2025-12-31', 1855.00),
-- ('12301', 'C006', 0, 1447, '2025-01-01', '2025-12-31', 2250.00),
-- ('12302', 'C001', 0, 1450, '2025-01-01', '2025-12-31', 4675.00),
-- ('12302', 'C002', 0, 1450, '2025-01-01', '2025-12-31', 2765.00),
-- ('12302', 'C003', 0, 1450, '2025-01-01', '2025-12-31', 1870.00),
-- ('12302', 'C006', 0, 1450, '2025-01-01', '2025-12-31', 2265.00),
-- ('12303', 'C001', 0, 1464, '2025-01-01', '2025-12-31', 3355.00),
-- ('12303', 'C002', 0, 1464, '2025-01-01', '2025-12-31', 1950.00),
-- ('12303', 'C003', 0, 1464, '2025-01-01', '2025-12-31', 1355.00),
-- ('12303', 'C004', 0, 1464, '2025-01-01', '2025-12-31', 755.00),
-- ('12304', 'C001', 0, 1464, '2025-01-01', '2025-12-31', 3355.00),
-- ('12304', 'C002', 0, 1464, '2025-01-01', '2025-12-31', 1950.00),
-- ('12304', 'C003', 0, 1464, '2025-01-01', '2025-12-31', 1355.00),
-- ('12304', 'C004', 0, 1464, '2025-01-01', '2025-12-31', 755.00),
-- ('12305', 'C001', 0, 1445, '2025-01-01', '2025-12-31', 4650.00),
-- ('12305', 'C002', 0, 1445, '2025-01-01', '2025-12-31', 2740.00),
-- ('12305', 'C003', 0, 1445, '2025-01-01', '2025-12-31', 1845.00),
-- ('12306', 'C001', 0, 1445, '2025-01-01', '2025-12-31', 4650.00),
-- ('12306', 'C002', 0, 1445, '2025-01-01', '2025-12-31', 2740.00),
-- ('12306', 'C003', 0, 1445, '2025-01-01', '2025-12-31', 1845.00),
-- ('12307', 'C002', 0, 1802, '2025-01-01', '2025-12-31', 3155.00),
-- ('12307', 'C003', 0, 1802, '2025-01-01', '2025-12-31', 2150.00),
-- ('12307', 'C004', 0, 1802, '2025-01-01', '2025-12-31', 1080.00),
-- ('12308', 'C002', 0, 1802, '2025-01-01', '2025-12-31', 3155.00),
-- ('12308', 'C003', 0, 1802, '2025-01-01', '2025-12-31', 2150.00),
-- ('12308', 'C004', 0, 1802, '2025-01-01', '2025-12-31', 1080.00),
-- ('12309', 'C001', 0, 1415, '2025-01-01', '2025-12-31', 4550.00),
-- ('12309', 'C002', 0, 1415, '2025-01-01', '2025-12-31', 2680.00),
-- ('12309', 'C003', 0, 1415, '2025-01-01', '2025-12-31', 1810.00),
-- ('12310', 'C001', 0, 1415, '2025-01-01', '2025-12-31', 4550.00),
-- ('12310', 'C002', 0, 1415, '2025-01-01', '2025-12-31', 2680.00),
-- ('12310', 'C003', 0, 1415, '2025-01-01', '2025-12-31', 1810.00),
-- ('12311', 'C002', 0, 1713, '2025-01-01', '2025-12-31', 2950.00),
-- ('12311', 'C003', 0, 1713, '2025-01-01', '2025-12-31', 1985.00),
-- ('12311', 'C004', 0, 1713, '2025-01-01', '2025-12-31', 965.00),
-- ('12312', 'C002', 0, 1713, '2025-01-01', '2025-12-31', 2950.00),
-- ('12312', 'C003', 0, 1713, '2025-01-01', '2025-12-31', 1985.00),
-- ('12312', 'C004', 0, 1713, '2025-01-01', '2025-12-31', 965.00),
-- ('12313', 'C001', 0, 1458, '2025-01-01', '2025-12-31', 4665.00),
-- ('12313', 'C002', 0, 1458, '2025-01-01', '2025-12-31', 2755.00),
-- ('12313', 'C003', 0, 1458, '2025-01-01', '2025-12-31', 1860.00),
-- ('12314', 'C001', 0, 1458, '2025-01-01', '2025-12-31', 4665.00),
-- ('12314', 'C002', 0, 1458, '2025-01-01', '2025-12-31', 2755.00),
-- ('12314', 'C003', 0, 1458, '2025-01-01', '2025-12-31', 1860.00),
-- ('12315', 'C002', 0, 1652, '2025-01-01', '2025-12-31', 2850.00),
-- ('12315', 'C003', 0, 1652, '2025-01-01', '2025-12-31', 1920.00),
-- ('12315', 'C004', 0, 1652, '2025-01-01', '2025-12-31', 935.00),
-- ('12316', 'C002', 0, 1652, '2025-01-01', '2025-12-31', 2850.00),
-- ('12316', 'C003', 0, 1652, '2025-01-01', '2025-12-31', 1920.00),
-- ('12316', 'C004', 0, 1652, '2025-01-01', '2025-12-31', 935.00),
-- ('12317', 'C002', 0, 1940, '2025-01-01', '2025-12-31', 3355.00),
-- ('12317', 'C003', 0, 1940, '2025-01-01', '2025-12-31', 2285.00),
-- ('12317', 'C004', 0, 1940, '2025-01-01', '2025-12-31', 1120.00),
-- ('12318', 'C002', 0, 1940, '2025-01-01', '2025-12-31', 3355.00),
-- ('12318', 'C003', 0, 1940, '2025-01-01', '2025-12-31', 2285.00),
-- ('12318', 'C004', 0, 1940, '2025-01-01', '2025-12-31', 1120.00),
-- ('12319', 'C001', 0, 1367, '2025-01-01', '2025-12-31', 4455.00),
-- ('12319', 'C002', 0, 1367, '2025-01-01', '2025-12-31', 2620.00),
-- ('12319', 'C003', 0, 1367, '2025-01-01', '2025-12-31', 1765.00),
-- ('12320', 'C001', 0, 1367, '2025-01-01', '2025-12-31', 4455.00),
-- ('12320', 'C002', 0, 1367, '2025-01-01', '2025-12-31', 2620.00),
-- ('12320', 'C003', 0, 1367, '2025-01-01', '2025-12-31', 1765.00),
-- ('12365', 'C002', 0, 419, '2025-01-01', '2025-12-31', 1255.00),
-- ('12365', 'C003', 0, 419, '2025-01-01', '2025-12-31', 855.00),
-- ('12365', 'C005', 0, 419, '2025-01-01', '2025-12-31', 655.00),
-- ('12366', 'C002', 0, 419, '2025-01-01', '2025-12-31', 1255.00),
-- ('12366', 'C003', 0, 419, '2025-01-01', '2025-12-31', 855.00),
-- ('12366', 'C005', 0, 419, '2025-01-01', '2025-12-31', 655.00),
-- ('12367', 'C002', 0, 700, '2025-01-01', '2025-12-31', 1600.00),
-- ('12367', 'C003', 0, 700, '2025-01-01', '2025-12-31', 1095.00),
-- ('12367', 'C004', 0, 700, '2025-01-01', '2025-12-31', 545.00),
-- ('12368', 'C002', 0, 700, '2025-01-01', '2025-12-31', 1600.00),
-- ('12368', 'C003', 0, 700, '2025-01-01', '2025-12-31', 1095.00),
-- ('12368', 'C004', 0, 700, '2025-01-01', '2025-12-31', 545.00),
-- ('12375', 'C003', 0, 222, '2025-01-01', '2025-12-31', 550.00),
-- ('12375', 'C004', 0, 222, '2025-01-01', '2025-12-31', 290.00),
-- ('12375', 'C007', 0, 222, '2025-01-01', '2025-12-31', 175.00),
-- ('12376', 'C003', 0, 222, '2025-01-01', '2025-12-31', 550.00),
-- ('12376', 'C004', 0, 222, '2025-01-01', '2025-12-31', 290.00),
-- ('12376', 'C007', 0, 222, '2025-01-01', '2025-12-31', 175.00),
-- ('12383', 'C003', 0, 222, '2025-01-01', '2025-12-31', 550.00),
-- ('12383', 'C004', 0, 222, '2025-01-01', '2025-12-31', 290.00),
-- ('12383', 'C007', 0, 222, '2025-01-01', '2025-12-31', 175.00),
-- ('12384', 'C003', 0, 222, '2025-01-01', '2025-12-31', 550.00),
-- ('12384', 'C004', 0, 222, '2025-01-01', '2025-12-31', 290.00),
-- ('12384', 'C007', 0, 222, '2025-01-01', '2025-12-31', 175.00);

-- -- First, let's create some base fare rates for each class
-- -- These are example rates - in a real system you'd use official fare charts
-- SET @first_ac_rate = 5.00;
-- SET @second_ac_rate = 3.50;
-- SET @third_ac_rate = 2.50;
-- SET @sleeper_rate = 1.80;
-- SET @chair_car_rate = 2.00;
-- SET @exec_chair_rate = 3.00;
-- SET @second_sitting_rate = 1.20;
-- SET @general_rate = 0.80;
-- SET @first_class_rate = 4.50;
-- SET @eog_rate = 0.00; -- End On Generation Car typically has no fare

-- -- For simplicity, we'll use current date as From_date and 1 year later as To_date
-- SET @from_date = CURDATE();
-- SET @to_date = DATE_ADD(@from_date, INTERVAL 1 YEAR);

-- -- Now populate fares for all trains and classes
-- INSERT INTO Train_fare (Train_code, Class_id, From_Km, To_Km, From_date, To_date, Fare)
-- SELECT 
--     vd1.Train_code,
--     c.Class_id,
--     vd1.Km_from_origin AS From_Km,
--     vd2.Km_from_origin AS To_Km,
--     @from_date AS From_date,
--     @to_date AS To_date,
--     CASE 
--         WHEN c.Class_code = '1A' THEN (vd2.Km_from_origin - vd1.Km_from_origin) * @first_ac_rate
--         WHEN c.Class_code = '2A' THEN (vd2.Km_from_origin - vd1.Km_from_origin) * @second_ac_rate
--         WHEN c.Class_code = '3A' THEN (vd2.Km_from_origin - vd1.Km_from_origin) * @third_ac_rate
--         WHEN c.Class_code = 'SL' THEN (vd2.Km_from_origin - vd1.Km_from_origin) * @sleeper_rate
--         WHEN c.Class_code = 'CC' THEN (vd2.Km_from_origin - vd1.Km_from_origin) * @chair_car_rate
--         WHEN c.Class_code = 'EC' THEN (vd2.Km_from_origin - vd1.Km_from_origin) * @exec_chair_rate
--         WHEN c.Class_code = '2S' THEN (vd2.Km_from_origin - vd1.Km_from_origin) * @second_sitting_rate
--         WHEN c.Class_code = 'GN' THEN (vd2.Km_from_origin - vd1.Km_from_origin) * @general_rate
--         WHEN c.Class_code = 'FC' THEN (vd2.Km_from_origin - vd1.Km_from_origin) * @first_class_rate
--         WHEN c.Class_code = 'EOG' THEN 0
--         ELSE (vd2.Km_from_origin - vd1.Km_from_origin) * 1.50 -- Default rate
--     END AS Fare
-- FROM 
--     Via_details vd1
-- JOIN 
--     Via_details vd2 ON vd1.Train_code = vd2.Train_code
-- JOIN 
--     Class c
-- WHERE 
--     vd2.Km_from_origin > vd1.Km_from_origin
--     AND NOT EXISTS (
--         SELECT 1 FROM Via_details vd3 
--         WHERE vd3.Train_code = vd1.Train_code 
--         AND vd3.Km_from_origin > vd1.Km_from_origin 
--         AND vd3.Km_from_origin < vd2.Km_from_origin
--     )
--     AND c.Class_id != 'C010' -- Exclude EOG class as it typically has no fare
-- ORDER BY 
--     vd1.Train_code, vd1.Km_from_origin, vd2.Km_from_origin, c.Class_id;

-- First, let's create some base fare rates for each class
-- These are example rates - in a real system you'd use official fare charts
SET @first_ac_rate = 5.00;
SET @second_ac_rate = 3.50;
SET @third_ac_rate = 2.50;
SET @sleeper_rate = 1.80;
SET @chair_car_rate = 2.00;
SET @exec_chair_rate = 3.00;
SET @second_sitting_rate = 1.20;
SET @general_rate = 0.80;
SET @first_class_rate = 4.50;
SET @eog_rate = 0.00;

SET @from_date = CURDATE();
SET @to_date = DATE_ADD(@from_date, INTERVAL 1 YEAR);

INSERT INTO Train_fare (Train_code, Class_id, From_Km, To_Km, From_date, To_date, Fare)
SELECT 
    vd1.Train_code,
    c.Class_id,
    vd1.Km_from_origin AS From_Km,
    vd2.Km_from_origin AS To_Km,
    @from_date AS From_date,
    @to_date AS To_date,
    CASE 
        WHEN c.Class_code = '1A' THEN (vd2.Km_from_origin - vd1.Km_from_origin) * @first_ac_rate
        WHEN c.Class_code = '2A' THEN (vd2.Km_from_origin - vd1.Km_from_origin) * @second_ac_rate
        WHEN c.Class_code = '3A' THEN (vd2.Km_from_origin - vd1.Km_from_origin) * @third_ac_rate
        WHEN c.Class_code = 'SL' THEN (vd2.Km_from_origin - vd1.Km_from_origin) * @sleeper_rate
        WHEN c.Class_code = 'CC' THEN (vd2.Km_from_origin - vd1.Km_from_origin) * @chair_car_rate
        WHEN c.Class_code = 'EC' THEN (vd2.Km_from_origin - vd1.Km_from_origin) * @exec_chair_rate
        WHEN c.Class_code = '2S' THEN (vd2.Km_from_origin - vd1.Km_from_origin) * @second_sitting_rate
        WHEN c.Class_code = 'GN' THEN (vd2.Km_from_origin - vd1.Km_from_origin) * @general_rate
        WHEN c.Class_code = 'FC' THEN (vd2.Km_from_origin - vd1.Km_from_origin) * @first_class_rate
        WHEN c.Class_code = 'EOG' THEN 0
        ELSE (vd2.Km_from_origin - vd1.Km_from_origin) * 1.50 
    END AS Fare
FROM 
    Via_details vd1
JOIN 
    Via_details vd2 ON vd1.Train_code = vd2.Train_code
JOIN 
    Class c
WHERE 
    vd2.Km_from_origin > vd1.Km_from_origin
    AND NOT EXISTS (
        SELECT 1 FROM Via_details vd3 
        WHERE vd3.Train_code = vd1.Train_code 
        AND vd3.Km_from_origin > vd1.Km_from_origin 
        AND vd3.Km_from_origin < vd2.Km_from_origin
    )
    AND c.Class_id != 'C010' 
ORDER BY 
    vd1.Train_code, vd1.Km_from_origin, vd2.Km_from_origin, c.Class_id;